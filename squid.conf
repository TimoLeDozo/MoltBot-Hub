# Configuration Squid Proxy pour OpenClaw Bot
# Whitelist stricte des domaines autorisés

# Port d'écoute
http_port 3128

# Ports autorisés (sécurité de base)
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl CONNECT method CONNECT

# Bloquer CONNECT vers des ports non-SSL
http_access deny CONNECT !SSL_ports
# Bloquer les ports non sûrs
http_access deny !Safe_ports

# ACL pour les domaines autorisés
# Format: .domain.com autorise domain.com et tous les sous-domaines

# Domaines de test et documentation
acl allowed_domains dstdomain .example.com
acl allowed_domains dstdomain .wikipedia.org

# Communication Telegram
acl allowed_domains dstdomain .telegram.org
acl allowed_domains dstdomain .t.me

# Développement et code
acl allowed_domains dstdomain .github.com
acl allowed_domains dstdomain .githubusercontent.com
acl allowed_domains dstdomain .stackoverflow.com
acl allowed_domains dstdomain .stackexchange.com
acl allowed_domains dstdomain .codepen.io

# AI et recherche
acl allowed_domains dstdomain .openai.com
acl allowed_domains dstdomain .api.nvidia.com .moonshot.cn
acl allowed_domains dstdomain .duckduckgo.com .ddg.gg .bing.com .cloudflare.com .brave.com .search.brave.com
acl allowed_domains dstdomain api.search.brave.com
acl allowed_domains dstdomain .links.duckduckgo.com

# Google services (pour Gemini API)
acl allowed_domains dstdomain .googleapis.com
acl allowed_domains dstdomain .google.com
acl allowed_domains dstdomain .gstatic.com

# NPM et Node
acl allowed_domains dstdomain .npmjs.com
acl allowed_domains dstdomain .npmjs.org
acl allowed_domains dstdomain .nodejs.org

# CDN et ressources
acl allowed_domains dstdomain .cdnjs.com
acl allowed_domains dstdomain .jsdelivr.net
acl allowed_domains dstdomain .unpkg.com

# Documentation technique
acl allowed_domains dstdomain .developer.mozilla.org
acl allowed_domains dstdomain .mdn.io
acl allowed_domains dstdomain .w3.org

# Règles d'accès
http_access allow allowed_domains
http_access deny all

# Logs pour debugging
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log

# Désactiver le cache (optionnel, simplifie la config)
cache deny all

# Headers de forwarding (off pour ne pas exposer l'IP interne)
forwarded_for off
via off

# Timeout
read_timeout 5 minutes
request_timeout 5 minutes

# Taille max des objets
maximum_object_size 100 MB

# Messages d'erreur personnalisés
error_directory /usr/share/squid/errors/en

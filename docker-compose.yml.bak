services:
  moltbot:
    build: .
    container_name: moltbot_hub
    volumes:
      - ./config:/root/.clawdbot
      - ./workspace:/app/workspace
    environment:
      # Configuration Ollama pour Clawdbot
      - OLLAMA_HOST=http://host.docker.internal:11434
      - OLLAMA_API_KEY=ollama-local
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_TOKEN}
      - GOOGLE_AI_STUDIO_KEY=${GOOGLE_API_KEY}
    ports:
      - "18789:18789"
    # C'est ICI que la magie opère (ne supprime pas ça !)
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    # Restrictions de sécurité - Isolation du système hôte
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
      - CHOWN
      - SETGID
      - SETUID
      - DAC_OVERRIDE